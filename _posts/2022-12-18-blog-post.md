---
title: "HTML Canvas를 활용한 Text Interaction"
date: 2022-12-18
permalink: /posts/2022-12-18-blog-post/
type: posts
tags:
  - CSS
  - HTML
  - JS
  - Animation
---

## 구현순서

1. 텍스트 중앙 정렬
2. canvas 상에 있는 모든 픽셀을 배열형태로 저장한다.(픽셀 한개당 4개의 숫자로 구성이 된다. 후술함)
3. 마우스와 픽셀사이의 거리 계산후, 효과 적용해주는 함수를 넣으면 된다.
4. requestAnimationFrame이라는 함수를 이용해서, 빠르게 픽셀들을 그린다.(각 픽셀들은 위치가 정해져있고, 계속해서 변함)

---

1. 텍스트를 중앙 정렬해주는 함수를 만든다.

```
// context 객체는 이미 선언되어있다고 전제
maxLength = this.canvas.innerWidth * 0.8;
function wrapText(message){
  let lineArr = [];
  let line = "";
  let lineNumber = 0;
  let words = message.split(" ");
  const textHeight = this.lineHeight * line.length;
  const textX = this.canvas.innerWidth/2;
  const textY = this.canvas.innerHeight/2;
  let testLine = "";
  for(let i=0;i < words.length; i++){
    testLine += words[i] + " ";
    if(this.context.measureText(testLine).width > this.maxLength){
      testLine = words[i]
      lineNumber++;
    }
    line = testLine;
    lineArr[lineNumber] = line;
    lineArr.foreach((l,index)=>{
      context.fillText(l, textX, textY + (index*this.lineHeight));
    })
    // 여기에 그린 글자들을 pixel 데이터로 변환하는 함수 만들거임
    // convertToParticles()
  }

}
```

2. canvas상에 그려진 text를 픽셀 데이터로 변환한다.

- 1px 은 4개의 digit으로 구성되어있음.
- 예를 들어 canvas 가로 세로 1px 이라고 하면, 아래 pixels.length = 4 가 될것.
- 이유는 1px 을 red, green, blue, alpha 4가지 digit(0-255) 데이터로 표현하고 있기 때문이다.

```
gap = 3; // 픽셀을 그리려고 하지만, 실제 픽셀과 똑같은 크기(개당, 1px)로 만들면, 성능상 이슈, 그래서 3으로 잡음 즉 픽셀 3개당 1개의 정사각형을 그릴거임(픽셀처럼 보이게)
function convertToParticles(){
  const pixels = context.getImageData().data;
  for(let y = 0; y < canvas.height; y+= gap){
    for(let x =0; x < canvas.width; x+= gap){
      const index = ((y * canvas.width) + x) * 4;
      const alpha = pixels[index + 3];
      if(alpha > 0){
        const red = pixels[index+1];
        const green = pixels[index+2];
        const blue = pixels[index+3];
        const colours = `rgba(${red}, ${green}, ${blue}, ${alpha})`;
        context.fillStyle = colours;
        context.fillRect(x,y,gap, gap);
      }
    }
  }
}


```

3. 픽셀데이터에 마우스를 가져다 됬을 때 움직임을 구현한다.

```

```

<p class="codepen" data-height="300" data-theme-id="dark" data-default-tab="js,result" data-slug-hash="VwdgpMj" data-user="idjjm92" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/idjjm92/pen/VwdgpMj">
  pixelizing</a> by jimmy jung (<a href="https://codepen.io/idjjm92">@idjjm92</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>

구현내용: [codepen](https://codepen.io/idjjm92/pen/VwdgpMj)
<br/>
구현내용: [https://github.com/jimyeong/animations](https://github.com/jimyeong/animations/tree/master/assets/js/pixelizing)
